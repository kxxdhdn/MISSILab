#+TITLE: MILES
#+AUTHOR: Dangning HU

Mid-Infrared Line Extraction Software
* Mode d'emploi
** Path
Modify the following paths
- ~make_miles.mk~
  + ~MKSW~
  + ~MILIBDIR~
- ~swing/make_swing.mk~
  + ~LIBDIR~
- ~swing/Tools/utilities.f90~
  + ~LibF~
  + ~temproot~
- ~pylib/auxil.py~
  + ~mroot~
** Database
Download ~Model_templates/Cross_sections/Data/~ (542.1 MB) and put it in ~swing/~
** Make
#+begin_src bash
## In swing/Programs/
make

## In src/
make

## In tests/
make

## If clean
make mrproper
#+end_src
** Generating synthetic spectra
#+BEGIN_SRC bash
pip install rapyuta --upgrade

## Fitting original parameters
python pylib/input_presimulation.py
./src/presimulation
python pylib/show_presimulation.py # optional

## Generating models with new parameters
./src/simulation
## Line 40-42 & 65 may can be modified according to simulation.90
python pylib/show_simulation.py # optional
#+END_SRC
** Facts (modifiable) in ~simulation.f90~
*** Sample size
- ~Np~: sub-sample size for each configuration
- ~Nq~: number of configurations (varying ~SovN~ and ~multiCONT~)
*** ~wvl0~: reference wavelength of ~SovN~ and ~multiCONT~ (Default: 15 \mu{}m)
*** ~ratname~, ~mulnR~ and ~siglnR~ (diag of ~Smat~)
- mean and stdev of ~Nrat~ band ratios to vary (fixing 11.2)
*** ~corr~: ~Ncorr~ correlation coefficients for different band ratios (triangles of ~Rmat~)
** Fitting
Put ~pylib/~ and ~data/~ in your work directory. 
The outputs can be found in ~out/~.
#+BEGIN_SRC bash
pip install rapyuta --upgrade

## Chi2 fit
python pylib/input_sim_chi2.py # simulation
python pylib/input_chi2.py
./src/fit_chi2

## BB fit
python pylib/input_sim_bb.py # simulation
python pylib/input_bb.py
./src/fit_hb

## HB fit
python pylib/input_sim_hb.py # simulation
python pylib/input_hb.py
./src/fit_hb

## Post-processing
python pylib/input_analysis.py
./src/analysis

## Plot (results in out/Figures/)
## Line 36-38 should be coherent with simulation.f90
python pylib/show_fit.py # fitted spectra
python pylib/show_par.py # parameter distribution
python pylib/show_corr.py # feature correlations
#+END_SRC
* Notices
The Python package [[https://github.com/kxxdhdn/RAPYUTA][rapyuta]] is required by the MILES UI (pylib). You can install it in commandline: ~pip install rapyuta --upgrade~
* Version log
** v1.x (2021xxxx)
- Added robust/skewed RMS (student/split gaussian distribution) for likelihood
- Attenuation (extinction with different geometries) in ~specModel~
- Calculated derived parameter errors with gradient function
  + exclusively for chi2, changes in ~aux/core.f90~ and ~src/fit_chi2.f90~
- Fractional data saving during program run
- Parallelization
- Simplified version of input UI ~pylib/fast_input.py~
** v1 (2021xxxx, HB release)
** v0.3.9 (2021xxxx, prelease)
- Update tests/
- Add manuel documentation files
- Final clean before the first complete release
** v0.3.8 (202111xx, paper)
- Update simulation
  + (A bit) more realistic dust continuum by varying Tdust instead of M/d^2
  + Ratios of summed bands
- Add extinction curves of ices
- Improve plots
** ---------- WE ARE HERE ----------
** v0.3.7 (20211119, thesis2)
- Modify parameter limits
  + ~lnAv~ ((0,1) \rarr (0,5)) 
  + IRS calibration errors (15% \rarr 5%)
- Update simulation
- presimulation
  + Shorten file name
  + Support bb/hb fitted param inputs (thus calib error included)
- Correct ~auxil.py/calexpansion~ initialization (1 \rarr 0)
- Improve plots
  + Add ~pylib/lib_corr.py~
** [[./arx/version_log_arx.org][Archived (v<0.3.7)]]
